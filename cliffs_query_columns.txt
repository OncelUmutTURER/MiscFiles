MH.HEAT_NUMBER,
BOFV.LADLE_NUMBER,

MH.TAP_GRADE,
MH.MET_FINAL_HT_GRADE,

BOFV.LADLE_PREHEAT_ON_TIME,
BOFV.LADLE_PREHEAT_OFF_TIME,
(case when CAST((BOFV.LADLE_PREHEAT_OFF_TIME - BOFV.LADLE_PREHEAT_ON_TIME)minute AS FLOAT) < -120 then CAST((BOFV.LADLE_PREHEAT_OFF_TIME - BOFV.LADLE_PREHEAT_ON_TIME)minute AS FLOAT) + 1440 else abs(CAST((BOFV.LADLE_PREHEAT_OFF_TIME - BOFV.LADLE_PREHEAT_ON_TIME)minute AS FLOAT)) end) as PREHEAT_DURATION,

BOFV.START_TAP_TIME as BOF_START_TAP_TIME,
BOFV.END_TAP_TIME as BOF_END_TAP_TIME,
NULLIF(GREATEST(CAST((BOFV.END_TAP_TIME - BOFV.START_TAP_TIME)minute AS FLOAT),0),0) as BOF_TAP_DURATION,
NULLIF(GREATEST(CAST((BOFV.OG_STOP_TIME - BOFV.OG_START_TIME)minute AS FLOAT),0),0) as BOF_OG_DURATION,
BOFV.N2_BLOW_DURATION,
NULLIF(ABS(BOFV.LADLE_TEMPERATURE),0) AS BOF_LADLE_TEMP,
NULLIF(LADLE_LINING_TEMP,0) AS BOF_LADLE_LINING_TEMP,
C531_CALC_WEIGHT/1000.0 AS TAPPED_TONS,

MH.DEGAS_DATE_TIME,

DEGHT.DEG_INSTANCES,
DEGHT.avg_DEG_DEPART_TEMP AS DEG_AVG_DEPART_TEMP,
DEGHT.min_ejStartTime AS DEG_MIN_EJ_START_TIME,
DEGHT.max_ejStopTime AS DEG_MAX_EJ_START_TIME,
DEGHT.ej_DURATION AS DEG_EJ_DURATION,
DEGHT.stir_DURATION AS DEG_STIR_DURATION,
DEGHT.stir_avg_high_flow AS DEG_STIR_WAVG_HIGH_FLOW,
DEGHT.stir_avg_low_flow AS DEG_STIR_WAVG_LOW_FLOW,
DEGHT.deg_ktb_duration AS DEG_KTB_DURATION,
DEGHT.deg_act_duration AS DEG_KTB_ACT_DURATION,
DEGHT.ktb_count AS DEG_KTB_COUNT,

MH.CASOB_DATE_TIME,

CSBHT.CSB_INSTANCES,
CSBHT.CSB_DURATION,
CSBHT.min_arriveTime AS CSB_MIN_ARRIVE_TIME,
CSBHT.max_departTime AS CSB_MAX_DEPARTURE_TIME,
CSBHT.min_TEMP AS CSB_MIN_TEMP,
CSBHT.max_TEMP AS CSB_MAX_TEMP,
CSBHT.OB_INSTANCES AS CSB_OB_INSTANCES,
CSBHT.O2_DURATION AS CSB_OB_DURATION,
CSBHT.min_O2_START_BLOW_TIME AS CSB_OB_MIN_O2_START_BLOW_TIME,
CSBHT.max_O2_END_BLOW_TIME AS CSB_OB_MAX_O2_END_BLOW_TIME,
CSBHT.avg_O2_AVG_FLOW_RATE AS CSB_OB_O2_AVG_FLOW_RATE,
CSBHT.TOTAL_AL_USED AS CSB_OB_TOTAL_AL_USED,

COALESCE(
	(CASE WHEN NULLIF(cast(CASTHT.LADLE_OPEN_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CASTHT.LADLE_OPEN_TIME END), 
	(CASE WHEN NULLIF(cast(CASTHT.CAST_START_DATE_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CASTHT.CAST_START_DATE_TIME END),
	MH.CASTER_START_DATE_TIME
) AS CAST_LADLE_OPEN_TIME,

CASE WHEN NULLIF(cast(CASTHT.CAST_END_DATE_TIME as time), cast('00:00:00' as time)) is null THEN 
	COALESCE(
		(CASE WHEN NULLIF(cast(CASTHT.CAST_START_DATE_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CASTHT.CAST_START_DATE_TIME END),
		(CASE WHEN NULLIF(cast(CASTHT.LADLE_OPEN_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CASTHT.LADLE_OPEN_TIME END),
		MH.CASTER_START_DATE_TIME
	) + cast(CASTHT.CAST_MINUTES_B as interval minute)
ELSE CASTHT.CAST_END_DATE_TIME END as CAST_END_DATE_TIME,

NULLIF(GREATEST(CAST(((CASE WHEN NULLIF(cast(CAST_END_DATE_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CAST_END_DATE_TIME END) - (CASE WHEN NULLIF(cast(CAST_START_DATE_TIME as time), cast('00:00:00' as time)) IS NULL THEN NULL ELSE CAST_START_DATE_TIME END))minute AS FLOAT),0),0) as CAST_DURATION,
CASTHT.NET_HEAT_TONS AS CAST_NET_HEAT_TONS,
CASTHT.TAP_TEMP AS CAST_TAP_TEMP,

CASE WHEN DEGHT.ej_DURATION > 0 THEN 1 ELSE 0 END IsDegasser,
CASE WHEN CSBHT.CSB_DURATION > 0 THEN 1 ELSE 0 END IsCasob,

CASE WHEN MH.TAP_GRADE LIKE 'WIZ%' THEN 1 ELSE 0 END IsWIZ,
CASE WHEN MH.TAP_GRADE LIKE 'TDA%' OR MH.TAP_GRADE LIKE 'TDB%' THEN 1 ELSE 0 END IsTDAB,
CASE WHEN MH.TAP_GRADE LIKE 'AQN%' THEN 1 ELSE 0 END IsAQN,

CASE WHEN (GD.CALCIUM_MIN > 0 AND GD.SILICON_MIN > 0) THEN 1 ELSE 0 END IsCalSil
